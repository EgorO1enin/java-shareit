# ShareIt

Сервис для шеринга вещей. Позволяет пользователям сдавать в аренду свои вещи и брать в аренду вещи других пользователей.

## Описание проекта

Проект ShareIt предназначен для создания удобного сервиса, где пользователи могут делиться своими вещами с другими. Это
может быть особенно полезно в ситуациях, когда нужная вещь требуется на короткий период времени, и покупка её
нецелесообразна.

## Технологии

- Java 17
- Spring Boot
- Spring Data JPA
- PostgreSQL
- Maven
- MapStruct
- Lombok

## Функциональность

### Пользователи
- Создание пользователя
- Обновление данных пользователя
- Получение пользователя по ID
- Получение списка всех пользователей
- Удаление пользователя

### Вещи
- Создание вещи
- Обновление вещи
- Получение вещи по ID
- Получение списка вещей пользователя
- Поиск вещей по названию или описанию
- Добавление комментариев к вещам

### Бронирования
- Создание бронирования
- Подтверждение/отклонение бронирования
- Получение бронирования по ID
- Получение списка бронирований пользователя
- Получение списка бронирований для вещей пользователя

## API Endpoints

### Пользователи
- `POST /users` - создание пользователя
- `PATCH /users/{userId}` - обновление пользователя
- `GET /users/{userId}` - получение пользователя
- `GET /users` - получение всех пользователей
- `DELETE /users/{userId}` - удаление пользователя

### Вещи
- `POST /items` - создание вещи
- `PATCH /items/{itemId}` - обновление вещи
- `GET /items/{itemId}` - получение вещи
- `GET /items` - получение всех вещей пользователя
- `GET /items/search` - поиск вещей
- `POST /items/{itemId}/comment` - добавление комментария

### Бронирования
- `POST /bookings` - создание бронирования
- `PATCH /bookings/{bookingId}` - подтверждение/отклонение бронирования
- `GET /bookings/{bookingId}` - получение бронирования
- `GET /bookings` - получение списка бронирований пользователя
- `GET /bookings/owner` - получение списка бронирований для вещей пользователя

## База данных

### Таблицы
1. `users` - информация о пользователях
2. `items` - информация о вещах
3. `bookings` - информация о бронированиях
4. `comments` - комментарии к вещам

### Схема базы данных
```sql
CREATE TABLE IF NOT EXISTS users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(512) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    available BOOLEAN NOT NULL,
    owner_id BIGINT NOT NULL REFERENCES users(id),
    request_id BIGINT
);

CREATE TABLE IF NOT EXISTS bookings (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    item_id BIGINT NOT NULL REFERENCES items(id),
    booker_id BIGINT NOT NULL REFERENCES users(id),
    status VARCHAR(20) NOT NULL,
    CONSTRAINT check_dates CHECK (end_date > start_date)
);

CREATE TABLE IF NOT EXISTS comments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text TEXT NOT NULL,
    item_id BIGINT NOT NULL REFERENCES items(id),
    author_id BIGINT NOT NULL REFERENCES users(id),
    created TIMESTAMP NOT NULL
);
```

## Запуск приложения

1. Убедитесь, что у вас установлены:
   - Java 17
   - Maven
   - PostgreSQL

2. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE shareit;
```

3. Настройте подключение к базе данных в `application.properties`:
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/shareit
spring.datasource.username=your_username
spring.datasource.password=your_password
```

4. Запустите приложение:
```bash
mvn spring-boot:run
```

## Тестирование

Для запуска тестов выполните:
```bash
mvn test
```

## Структура проекта

```
src/main/java/ru/practicum/shareit/
├── booking/           # Логика бронирований
├── item/             # Логика вещей
├── user/             # Логика пользователей
├── exception/        # Обработка исключений
└── ShareItServerApplication.java
```

## Обработка ошибок

Приложение обрабатывает следующие ошибки:
- `NotFoundException` - ресурс не найден
- `ValidationException` - ошибка валидации
- `AccessDeniedException` - отказ в доступе
- `BookingException` - ошибка бронирования
- `ItemException` - ошибка работы с вещью
- `UserException` - ошибка работы с пользователем

## Пагинация

Для эндпоинтов, возвращающих списки, поддерживается пагинация:
- `from` - индекс первого элемента (по умолчанию 0)
- `size` - количество элементов на странице (по умолчанию 10)

## Безопасность

- Все запросы требуют заголовок `X-Sharer-User-Id` с ID пользователя
- Проверка прав доступа при работе с вещами и бронированиями
- Валидация входных данных
